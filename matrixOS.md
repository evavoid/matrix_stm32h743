# matrixOS

## 最初的设计理念

该系统被设计于应用于一些无过多抢占型事件的项目中，最初的设计初衷是为大学生参加各类比赛和项目提供一个方便的平台，提供一些统一的接口和标准以创造一个更便捷的编程环境。所以该系统在设计的时候所基于的理念就是：1.合理的抽象，对接口而不是对调用抽象，尽量让程序看起来简单直观，把重要的细节暴露给程序的编写者而不是隐藏起来，不过度的封装和清晰的设计将会大大减少程序潜在的bug。2.简洁且高效，每一个功能的添加都有被考量其实用性和其易排错性和可移植性，不加入过多花哨的但无用的功能，在遇到性能瓶颈之前，不过分地过早地去优化细节方面的代码。3.可移植性，这份代码是基于stm32f103rct6和正点原子的SYSTEM平台，但其顶层设计的抽象以及对接口的包装模式和相应的标准将使得该系统可以很容易地被移植到各大stm32工程文件中。4.开发社区，目前预计只有一个开发社区，其主要开发人员来自于电子科技大学电子科学与工程学院的电子科协。

## 设计思路

该系统的设计思路，是参考了很多的网上资料，并且参考了freeRTOS系统和UCOS系统内核以及linux系统的调度器设计。基于有限状态机的思想，吸纳了上述三个系统中的一些设计理念，将之抽离出来变成更符合于大学生参加各类比赛的所需的一个轻量级的系统，它简单但同样高效，状态机思想和数据空间思想的引入大大降低了程序的复杂度。该系统是一个基于有限状态机和时间片轮转调度法的实时的轻量级操作系统。

## 设计初衷

我们是希望能够给大家提供一个统一的模板，里面肯定还有一些考虑的不够充分的地方或者是有待改进的地方，所以也希望各位可以加入进来，一起将之变得更加地完善。

## 程序的抽象级设计

### 时间片的轮转

在例程中是使用了TIM5通用定时器（可改换的，优先级最好设置为较低的状态）。该定时级别是ms级别的，大约10ms（有一个宏定义可以用来配置，该宏定义将作为SYSTEM_timer_Init函数的入口参数，并约定该基准在单次程序期间不发生任何改变）为新一轮时间片的开启，该定时器的主要功能为将一个变量global_interpreter_flag（该名称取自python的全局解释器锁）在定时结束时置1。main函数里的主循环会不断检测这个标志位，只有在其为1时才进入到事件的调用环节，并在事件调用结束后负责将之清0。这样从宏观来看，程序被切分成很多等长的ms级别的时间片，并且其误差较低。如图![image.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArwAAADTCAYAAABjh8DlAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACMgSURBVHhe7d09ltu218fx2Va0IK0h5ezA6rIFN2lVusga/k6KOcedG8eVqyeVnosXUiBwLwByNBJJfT/nMLEkCARfJPzmDkd6uQAAAAA7RuAFAADArhF4AQAAsGv7C7yngyxv8cZMp+PlcjzHGwAAANiDfQVeF3ZfZJMWhVYJyQd57uLnAwAAYI1mBt43yZQvkgkPfUXU81EypLQ/nFycnHiTcPriHhsWpc0ssi4fVqUfy7+nPy6vL6+X1+Pf8Z5cEnrJvAAAALvwoYH37W6BdwiqB//P0t+XPyXo/nH6y//fDrziTQKzC7wvEqABAACweR8aeLtIwLRCcbehumsM6u/j6+VPX7ENwbcaeJ3h0giqvAAAAJs3Bt7z0QXZo5LxYsj1gfQaeI+nWL31YfU4yZqzqreNwPuWrkeWw1FpJ2OXDtxQGzoD71Dl5VpeAACAzRsDbwipWuX2LHlSwqYPf0PgVZYksN4q8Bb9DIu0vZJn+csZei5B6Ay8LvbLemrXAwMAAGAbxsDrLgtwYdLn2vjvg0u/MZD6f6eBV8Lg2d91CoFYqw43qree2SYG7TSEv13vu5IHCbwAAAAwXANvDJ4u8LrLGw6HQwihyf0uXJbX8A4h9MaBd7hfXQi8AAAA6HMNvDG4Hk6uYiuB9uwCp/z/5Kq9Q8C9Y+Ad+03XZfDX8MpSDCDHNbwAAADPJgm8McweDpeDD5/htq/0jmG2J/AObbTl+rzwR3Lacg3OZpu88jp8SkMzoHYGXj6lAQAAYDeSwJsEzBgcxz8aG6uv9w28rq9z9ikNfskDrxudrFMe8P/MjV84kS+Hv2KLlKxd1tF3iQQAAADWbhJ4N22o8hZheI4hOMtCdRcAAGAX9hN4neFShEXX3krYHa4F5tpdAACA3dhX4HVc6G3+lZvBPZewCwAAsCv7C7wAAABAgsALAACAXSPwAgAAYNcIvAAAANg1Ai8AAAB2zQ68p/i5tsaXOQAAAABboAfe4UscCLwAAADYOD3wDl/gsPTzbAEAAICV0AOv/8YxKrsAAADYPgIvAAAAdk0JvJJyDy7wHuNtAAAAYLumgddXduNyOsc7AQAAgO2yA++RwAsAAIDtmwZej0saAAAAsB9K4BX80RoAAAB2gsALAACAXdMD7/DFE2cSLwAAALZND7x8tTAAAAB2Qg+8zmkIvQReAAAAbJcdeAEAAIAdIPACAABg115eX1/jPwEAAID9ocILAACAXXvOCq/72LUTf4kH4Em5P0rm6+MBPJHnq/AOnzG85M3+fJSnvozL0vnifJTn32KyudF4NDcb4yPt/XjF/g788LYZ/lxKzoHx2H3ga7kk6/RfH7/wfRAANmgbFV6ZDA5uIjicKp+Q9nY5HQ+TSaMg/fg3eennfc6Xo/Tz8AA1et94NIvH6Cfuo4xoTXZ6vG4ReFd5vG5ghdv1Jj9st8d0+9eyLgm9uzv4AFBSUuH6vMnkVQ+8EnblzTsNu2XgHd7gb/G5wgReE4G3w71CTQcC7930nUd3PDfe5Ad/WZcMKt4BAPu1k2t4wyThJjiz2CUToH9zv8mvf/cfoAi8VwTeDVrddsUfypsH/c7nxvg18vE2AOxUXgZdlfArQBdk45JXeP2kljyeLvllCxJaWtXdYn1xKSef+qTUGvcQoKbtlMk53z6zwn2DSVLbl3mHlfFY+84txa/cu7er7mmPV7YerR83Zrff/djHttcxv+t45St0j/ttDds1tEubtcbjdfTjVcZz7+1qytcxWbRA3jg38v6Uc8zaB6qhyjtrowBge1Zd4W0FkepkIm2v5Fn+cgb7V3dhXckEFPvW5wF7UgoTejqRxcpOMvZx0h87UKo/MhEdJiuIk646oMYk2VBsu/BjXDIev9+0iTyatV22Zz5eV63tStcf2uqhzz5e5bmhbPv4OjyMv0DJn9e1Dzv66RqPc6ft6meMs1A5NzrOsWJ8cRvs1coD8ricGPE2AOyT8WP/yrg3evfGngfeUXzjNycieZZMNjIzxNulIuDFCaoICJ4xKcVx6vdfJ81yXaIxQTvq87zKJNmkP9de19XS7cj1rCtXPudZjlfK7kdb9/ztMPZp/hx/+7q/vCX7sNlP53gc7b7R7barX1infj6k5p0b+X4t93PtdeFIW1mfNIi3AWCftnENbwwmHxl451VGagFKmwyn7e3JP31unCD9diWLOqB5k+RE3LflcPJ1dY6nGjScOdtle9rjNWH3o43Z3g7reIX+i23yS77va8e8tu5kHzb76RyPc6ft6hfPj+ZBr50b7XOMCi8A6J6kwitkwvVv7EaDMFEkk4gstUlCnZSM8JgHq3bwiBNbtr3q87zaJNmiP3e6rhnjqYaEmdt1tD8z+XmPV8ruR1v3/OPVOc5qH0HXupv9zNhvd9qufvEcaa/UGFvfOTbvdSHkXJdGXMMLYPdWXOGNb/DZm3dY8qpcmCSqk5NMXtLAeGMP6+p/z7cnTD8BTcZRTnTl5B/6u/7aUZkc/eSbP2/QOYEb/HjGiTTZ72OHM8ZjhUhvznbJbbk/LHllPvSjr0Ozr+N11diu7AHtvvrxcg9nFUON39Z6m/Y+FB39dI3HudN29VPOEZV1THvOsbmvCyH7QTpxqwWAXZN3urWKb/DuDb1YFgRe6U9mQNli45MahskjX5LZI4QjZclmmKJd9nhXFSZO2GMbCaRn97wF42kb9l9YXAjxY0z76RjPIN++SaiZ0U+twvvMx6unH98m61e7z6keL6Ft/6SfjmCojbkYSmfAbI4nusd29asH3q5zo+e10/G6uJL75DF5MN4GgP3ayefwdpLJwL/By0QxZVRV4gRjzFF4GI7X1lhhG7dUf11MDQUAWTgsAJ5A/i64fyelamgEpVAByqvJeDiO1+YQeO+g8bq4kheIHI/ifRAAduy5KrwDF3rzVKT+KvBWv858hOllCupymP4BzKZwvDZlf4F3pcer93Xh3gMJuwCeyPNVeAEAAPBUnrPCCwAAgKdBhRcAAAC7RoUXAAAAu0aFFwAAALu2nQrvKX6GrvXFEQAAAIBiGxXe4QsjCLwAAACYaRsVXveZkS7s8o0CAAAAmGkbFV7/rUBUdgEAADDfNiq8BF4AAAAstIEKr6Tcgwu8x3gbAAAA6LfuCq+v7MblxPe+AwAAYL51V3jTwHsk8AIAAGC+DVzDyyUNAAAAWG7dFd4Bf7QGAACAhfiUBgAAAOzaNiq8wxdPnEm8AAAAmGcbFV6+WhgAAAALbaPC65yG0EvgBQAAQL9tVHgBAACAhbZT4QUAAAAWIPACAABg1wi8wFI/fl3OP+K/O5w//3M5fo03mn5djr9/u3ya0X/q7cu3y8vp500vd3fjf/n8K94CAGA7CLzAQj5U/i4hsHeZGRZ7Q6s2jt++/CeB/D95rgvO08cmy6wxub6+X/Iv+T5/Lu8DAGBNugKvr+xoE++Pn5ffWhMybWhj2WKb0X+XTyelAvv1ewibmVZ19/z5m6w7C6PZ8tuXn42qrxtTFj6N8Zjb6u5X1t1chr7ueSxoQxsLbWhjoc3+2iSGvKppB16ZMF+ySXacvN1AYoUor/LQRv5Bm3jf9tsUXFvlReiCaxFIjbZXfZcv+EpuHJ8qGf9AHY9wffltzrj7Q0D+5feBGm5jlTfte4vHlDbyD9rE+2gzoI38gzbyD3ffutsUlLyaagReVzGKvx5NuQHIxOcrTp9/+jbFSmhDmz21yaiXEciL0fUzvV+CpavealXWgXuRxhe0TasoJ5cryPPdG8S4Xhew43ZdxxIXv43aG8d0Heevxpj8m4rry4XmuF1rO160oQ1taEObYK9tJoy8mqgGXj+pm5Wp0HmYQK3Jmja02VObgX4t67U6mnL91l6kyU+yNe7FX6sS+xBa/oSsvvitgG3cP45vCLofvp9pQxvalGhDG9pY6nk1sANvTNfaRBwqSTKJf5U2bhB+IpxO6rShzZ7aTLjHXbsJ98JUqqbudVS0TcTXmX9Bm8t3+Qm39pPrUOmtjDmljj/sBz14xzedynas7XjRhja0oQ1tgr22GVXyasoMvH5lbiU1rcncoU28YaBNvGFYWxsf/pQXnfFc9zqqvQj1qnCufo1v+IM393gIpu4yg/GnYm1x4/Sf4JBw45efjj/5N5kZS77N9zwWtIk3DLSJNwy0iTcMtIk3DLSJNwx3bNOVV4UeeH2Sblwc7Lh2jRIybWhj2mobLfiZS+11pF8aMYcP1F/kDSGOW7uovxW6HRe8zTbFG84QrOPN1BqPF21stKGNhTa0saypjXu8cx5VAm/49Wi76gQ8G6O6614z2gvSvRArP3X2BNGaIaRWw2oWqtW/cnWBtvKGko/T+uQHAADuZ15eLQJvz4W/wFOSAGv9EVh5vxWOg75LGWwuhIbnu/VMQ6x7LK0y+79yjf8+fv11OWfhuB5g31+FBgDg1ubm1WngdZWeyrWCwPMyqri1a3qtF2Kj8tsyqbhW+6qHbqdeHRZWyAcA4FEW5NUk8LrJ8Z93TcTAPlWqnGmwddVTf2dagZ3yP5He8DWWX24w0bhUoR1m24EZAID7WpZXr4HXVYr41SWQqf9Kfxpsw/VE/lKCImiGx25aLfU/4cax+ddvXHd1SdobbxY+lA/t+QEYALAmC/NqCLx+4nzfH9AAe/T25edNfghsfiXiAm9ff9nV2wbzW9QAAFird+TV4o/WAAAAgD0h8AIAAGDXXl5fX+M/12Ft4wEAAMC2UeEFAADArlHhBQAAwK5R4QVSp4MsSz/7ALtzOl4ux1t/vgYA4N6o8N7a+Xh5eXkZF+bKDXFhV47Zhx00zo2NkR98DnI+fOQ5AQC4Cyq8H+Z8OS4ONeG5aTgal8Np8tmr52P6+EEtTr5JkEv7UMeUhbHDXqqcfruO7c/AlXbSUALOKd6Rkn1xjGHYt5G279o9nBum3uPVcqt+0tD7/s4AAA9ChffDvCfUaN4uJ5l4X5IOfVjJb2fBxoeeNAi9nWT+zsblw0HyvNhmF6G3K/gMoUZCrbbJsg994EkXNRj34twwrS7wCtlmf8ylPwDANsm7OD7GjUNNHjw0eWDRAoyYhqEQlvIAEwLSjQLDI/UEH2njA426c+WZk7Ajt304fk/44dww3Sqo3qqfgWyzPw8+ZKMBAB+NCu8MYaIPv9ZNFz241EPNvL7KCp5KDTVKEErDgNYm9tMMURrfd7JN6ZiNkKUGtlo/wlUnXRCb/tr+GnCs/euWojrpK7hGddcZHj9LgyH4ZH1wbrSV27XweOXnRlKlflc/tX0o2y2N7Gt5Zb3+8bk7BQBwF/IOjaWG0KWzQ02YlJPqU5x4zfnWP94OGKHftJ0ShsbAEtef9R0CpNw+ZwGpQ7FdyvqLX6Mrbbr7cdsx3hf2tx5q0r5y0l76lo7ibcUQdtzirt91wbeBcyPTPA5Rq50b42TFYV9OtsNp9NNzjk3J/bIeOajxdkp2kD+HrMcBAI9GhXchP2FOglvODjU+OEweCJOtHpBaE3HkJ3itjxgIhkXGfE4n+yHUxBAzrieGn9Zqr4xtyIPHsL6hmV9PGcRa/ZT7UL+vWH9B1uPDihV45Zn+8VjBc/93Q5N96G8rODcUcQzN5zSPV2n+ca+fYzrpScYvT4q3M8P5oB4nAMCj6TM26vyE35qU7VAzq4pXBEJFfH4z+ER+/UPbGF4mIdTpWe9EFp4mS7qvpmGjDId9/dwt8Eqf0oEblt8n/t+urb9fQk6Oc8M29hcWNcR3HC8f8pN+/DLruNfPMZ30JI+bgRcAsGpUeGdzk2XPZN8KNdOJ1sojPsTVqoVDiOgMNOW4wu08fJRBtMXe3sIYRrTn9PVzu8Ar0lCbGx47xQdlf/vbbinCjxs750aXODaryqqPOIbdbN3zj3vfOTYxHHfrSbJP/OPDeQIAWBV5h0Y/41ehKmtSDX10TbYxFJht5wYao30IWUlQa63XEPpphEsv7pujhBIlOPX00x14e7ZFwpEZZoYgoy2TwMu5MY+xv6r9h+dMxuiD7fzj3n+uRsN5YIxLVhbPC2nXcwoAAO6KCu8MYZKUyTVfklnVh65Gm3GSrrUZJnezkhYf1/pJJvLpmO3qY75tVlBoUfeR0tnQzgqIrX66A6/I+yrXKbd9YDHCivt6WXneuLg/XBvui9TxuiUfc6PNXs8Nbf/0HvtJuyGYD4vsA3/d8YLjro1J60cOSjz21uUOQvoKbQi8ALBG1xkbd2JU925WOcMiQ5V3UrW9N86N9ZH06n8YkqW6/+VB16YWigEAD0OF996M8BKqTT3Xf+LDDFW6RyVLzo2VkR1+jGG3dU4MPzBxkABgleQdGnen/tp6xvWEdxWqjuV4k8X81foGudD7yNDCubEu7nyohV35IUU29HI5SLuOz2cGADwGFV4AAADsGhVeAAAA7BoVXgAAAOwaFV4AAADsGhVe7Mivy/H3b5fTj3gT9/W/75eX008+hhYAsDpUeG/g/Pmf5kSvtnEB4ffvN/8L/Lcv3z6k31X78fNy+P2fy+HL/8U7rsL+kP3vF2O/cCxuwP3AoR8DAAAeiQrve/mg1KgqGm16gvISvt/Pv+KtDYsh9vi/eNtkB61p4Py/y+mkt9vksejePw236sf5oB8cAAB4Dyq872IHqCurTc9zl/iofh+gKzyF7dVDZb4vrLYbPRa3Cpc3DalUeQEA60OF9x189bBRFbTbhGBwk6raxEf1e3/d+9cMa1nANSrtWz0WPfunx636GezmNwwAgN2gwrtUz6+Ba238Y+0/sPLhQfoYlrJyFkJV2qZ5iYWhti49FIV152OqjnmsJk7HfW0TQ2ryWLpM96W+/lQIxMPzjf2yumOh9DMGyDn7R28b2szpp2fbr3xbM0AP23arijIAAG1UeBfyk3qjilVrU69MOjEYpM/PK5QxUOuBco6OdWn95m06+rkG0Oy+zjA9Uaw/N4SrbEyZNR6L6nZ7jXbd42mtr2PbM/XXRuxv9n4BAGA5KrxL9ASZRpt6FUwPDSGYDUEj+3V9pIfHuva6hFIFzdfV049v0+jH66i6Vrc1DXz+WAxVyxC40grmmo6FGjA11f0zYzyN/dx1bkzo6wYA4JGo8M7Wqog5rTYhFDSrasWSBOgY6LRfYdfHlutYlxfaXden3673o4UhY8wdP1RoYWwwfSyu14W9ot81HYso9hfWYwTL2v6ZM57qfu49N1L5eQEAwONR4Z2pp2rXbtMIBY2qm6e0CZW3mWGjZ12RC5FDYPLrSsNmVz/aduv7omc/24FXCXcxBJb7Z0XHQhH6Kddf3T8zxjO3n6aOH1QAALg3KrxzLAw/pRCyroHMBbT0OfnjCr+eJMD4oKEFupaOdUU+HLmA6dZVhKTeMWf7xthfIaDVg1MtrPkwnD4W91fZ55qORcnaD9X9k40n7KdvC/Zz/7kRtNqHx82ADQDAB6HC2y1UDa1foQc9bQIfyNzk75cyiFwDWrpMg0kIK/ExFyKM8NjUsS5vCHLW9jX6CcFrGna0+4IYjpR+RtVqYjwW4/PdftED12qORe9x8Or7p388jf08Y0zFDxmFYV0LzlEAAN6BCm+variKetrghkKA6q9A4qOEgN0KsvGHkGooBgDg9qjw9ohVruqvp3va4OZC0OKHjEfqC7v97QAAuDUqvHuUXENqLXuqirpfpa92e3Z/LFyVvRFix8si+MEEAPAYVHgBAACwa1R4AQAAsGtUeAEAALBrBF4AAADsGoEXAAAAu9YVeM0PlHd/fd36TE3a0MZCG9pYaEMbC21oY6HNc7ZJDHlV0w68/mOVph875Dr0nzfrBhK/dev8efqRQ7SRf9Am3kebAW3kH7SJ99FmQBv5B23ifbQZ0Eb+UWlTUPJqqhF4wzcjFZ8T6gbgPz/05+X4+Wf8CtdsJbShDW1oQ5uANrShDW1oE9yqzYSRVxPVwOu/GcksJcevCZUBvcT0XaINbWhTog1taFOiDW1oU6JNvU1Qz6uBHXhjuvYl5YwrNfuk/T9p4wZhXPZAG9rQhjYD2tCGNrShTUCb97cZVfJqygy8fmVuJTVuJbSx0SbeMNAm3jDQJt4w0CbeMNAm3jDQJt4w0CbeMNAm3jDcsU1XXhV64PVJunFxsOPatf56jja0sdCGNhba0MZCG9pYaPN8bdzjPXlVKIH31+X4e/3CXwAAAOBx5uXVIvD2XPgLAAAAPMrcvDoNvO5aCeuiYAAAAODRFuTVJPDGj3/ouPAXAAAAuL9lefUaeGdc+AsAAADc3cK8GgKvLw23P8MMAAAAeIh35NXij9YAAACAPSHwAgAAYNcIvAAAANi1l9fX1/jPdVjbeAAAALBtVHgBAE/j7cvPd38a0duP/+S//8n/w22N/1B898c1X+MdNV/dX513ts2YH77/4+flt9+/XT71fk6pjOG3L267biPso4H7RqwZYwE+ABVeAMATceEr/0ij/y6fTv90BL7Q7sWHt+Hf+jL0NQ1+mvD1qGbY/frLDugu1KrfNNW7PQkrIMcwPixHGU+5/6bKsC/P4TP+8WBUeG/tfLy8vLyMy3FhKeF8lOcvfXLqRuPR3GyMj7T34xX7O5z4svCt8OdScg6Mx+4DX8trdP4sAavxtaE9bTT58/ztViDzwc+qUkrA/FwZhw+TITAuWqxQa6zTbU8z7Pqw/K0Y1/HLMNawra6vNIzntwtuPxXjJfDi8ajwfpjz5fiOSen2YfJ949EsHqOfuI/VCsH97fR43SLwrvJ43cAKt+vtdOgY0+1fy4ud/7y8vryOyx+nf+MD71QNl1FPm1GsxsbQ5SuQQwBz/VTDWKjAlm3i/cUiY/qihb5cGNPsyxjM8ByqrkN11Xp84sd/xRjPn9N9KtuYbIfruxqk1bDrTPsBHoEK74ch8JoIvB3WFGoIvPfSdx6t5NzwYfePy19jGvrr8sdNQm/Pr+N72iSsX/2bAS3wld9JUAwh14dUMyi7sbWCeL1N7TKIMnS6MV3DbrlPKuvK94vfH98vn76GPib9SdtjZX/7oF35waGr6gx8ICq8H4bAayLwdiDwfrjVbdfb5XTYSuD99/LXoQy3/57+kBD8Z7y1jA9OjWpgTxsX0D7F6qlrX1RSk7DX9YdsLgwmFeW0EjoZjxWuRy6guueG0K5XY60w7J6TVWpj8DYDZTXUX8OyH/cksKZBuVahDdvRDLOuf9k2Qi8ehQrvTOFXjjIpZUs5+dQnpaKfw2nyZjIEqGk7ZXL2k/bwuCxZP1c3mCTzdbkl77AyHmvfuaX4lXv3dtU97fHK1qP148bs9rsf+9j2OuZ3Ha98he5xv61hu4Z2abPWeLyOfrzKeO69XU35OiaLFsgb50ben3KOWfsgkI7dv7VF+vJ8NTep7jqxwuuqvgVZn39+vn9zMRRVf83f00acJcSGtSWhbuD7SO4rwl4qBtPJ42kAnPavhuvIB2MXaKvh0Qq7Qqkqu+B9dIusUwvu+TW34xgay2+fv4/75Cz/zvt1Ql9h/Vofk8Vts/+hIdwG7o0K7wxhkkgmoDix6BOPPSmFCT2dyGJlJ5mYxkl/7ECp/rydLofJCuKkqw6oMUk2FNsu/BiXjMfvN20ij2Ztl+2Zj9dVa7vS9Ye2euizj1d5bijbPoaww5h58ud17cOOfrrG49xpu/oZ4yxUzo2Oc6wYX9yGaxP5h9xWlyHwZpcz/H0MQfevcwi9U9JItmvyfIO/hMAMnkFPGxcMx0piHhJduC0CpwutZdD061Lud0FP71+pwHqu/1DdDH3qiw+ZZhgexpO0l4A7qby6saS382A/wyS4Sz/Tyxnsqq4b4zTwN0I8cCfyDoReRcCTtxU3QRUBwTMmJTchmfdfJ81yXaIxQTvq87zKJNmkP9de19XS7cj1rCtXPudZjlfK7kdb9/ztMPZp/hx/+7q/vCX7sNlP53gc7b7R7barX1infj6k5p0b+X4t93PtdWEYAm8MuK/Hv8P9scpbkJAtO6pe4fXVv0Y4W9BmEsDyQDjKAq8Pinlwk83z19ZOQ+3kj7xc/5MwHoLhdTzTanBuEqQL8txs7EX7bPus/tz9aXB2y1HCtj3Oct2qYvuFdh/wAFR4Z2hXRlK1AKVNhtP29uSfPjdOkPK8yaIO6B0Byo+5fK41cTbHUw0azpztsj3t8Zqw+9HGbG+HdbxC/8U2+SXf97VjXlt3sg+b/XSOx7nTdvWL50fzoNfOjfY5Nu91YUguXygva1AuaWhyAUuvGF71tkmCWlLN9dXRLHi9ff3lH3PP+1TtNz5/CIZDP1m1OK9uTj/xQFTDXx4yM/Lc6bYrldPJZ/ZalVX9/jy4T9aVbadOG781BuD+qPDOECaK6URiTxLGpGSExzxYtYNHnNiSX6s76vO82iTZoj93uq4Z46mGhJnbdYyVI+Wx5z1eKbsfbd3zj1fnOKt9BF3rbvYzY7/dabv6xXOkvVJjbH3nWPt1ITfkPnWRvoO/L39K4FX/aO3wV7yVkHX655/0bfMVx0ag6mmTCxXOnz4o59XanpDruZCaPP8aDEOYO8ZPNHD9nYt1pGL4cx9ZJv2pixmGleDoQmitcmqFay28FsF9ui6/72vrsoKtG8PMYwZ8FCq83cJk0pyLRo2gMZkky4munPxDf9dfOyqTo5988+cNZgQBhR/POJHGdU/WNWM8Voj05myX3Jb7w3KM9w1CP/o6NPs6XleN7coe0O6rHy/3cFYx1HQEw/Y+FB39dI3HudN29VPOEZV1THvOsZ7XhTwoz1GXMfAOn8iQVHhj1fdPZVyyo2MfEnyTw+m5sGV+KkHU06bgQtg/EiT1qqkLcWUIToWKshX0xmquD8SVyuxAC5qJvDo84Z6bjaPaPm679ri23eEHgxjc/Ti/X45+38WlGlrdftKOjT0G4BHkHQjdhskjX5LZI4QjZclmmKJd9nhXdTJO2GMbmYzO7nkLxtMWJtnh+S6E+DGm/XSMZ5Bv3yTUzOinVuF95uPV049vk/Wr3edUj5fQtn/ST0cw1MZcDKUzYDbHE91ju/rVA2/XudHz2ul4XfQKoTd86YRbyrAbyRhkJUrgjaG0WT1stRkMIbdz0fqMFV0zxGYVX88H8uy+zCRUFiQ0NsLwZNx+mY4vrcraFdlw2cGx6O/a12Scta81Fn49xn6yxwA8BhXebkZVJU4wC+YKfCiO19ZYYRu3VH9dfBxZoetffjiY6KmO9rSJgdP+/NpeEgjVkJYEaSPEuVBaDbTKNqRB1nyu37bsuW6fFONIxmiEZzWETqrHro/GvhbDuPMxhwBcHwPwKFR4exlBKVSAtD9qwkNxvDaHwHsHjdfFhzlL0HWBN33hdVRFu9p8sBDi3hmka5VS5et9H+aHjLO6nSFUc5kCtogK7xzqrwJv9evMR5hepqAuh+kfwGwKx2tT9hd4V3q87vm6kIAtnV8uBwnT582+kwDYASq8AAAA2DUqvAAAANg1KrwAAADYtdVVeAEAAIBbosILAACAXVt3hXf4C1/3cTl8jhQAAAAWWHeFdwy8cdnTJxYBAADgLrZxDe/woeV8KD0AAABmWneFdyRBl8ALAACABTbyKQ0EXgAAACyzrQrvy/Gy3e+5BQAAwCNs53N4T4cYeqn0AgAAoN9GKryCwAsAAIAFtnUN7+EUbwMAAAB9NlLhjYGXyi4AAABm4lMaAAAAsGvbqPDyxRMAAABYaN0V3vyrhU98JhkAAADmWXeFNw28VHcBAACwwHY+hxcAAABYYN0VXgAAAOCdCLwAAADYNQIvAAAAdo3ACwAAgF2bBt7xUxEOfAQYAAAAdsEIvHHhk8AAAACwcdPAO+CbzQAAALATeuB1pV0CLwAAAHaAwAsAAIBdqwfel+Plwt+uAQAAYMOMwCtOhxh6qfQCAABguwi8AAAA2DUj8MZLGg6neBsAAADYpnrgpbILAACAjSPwAgAAYNf0wMsXTwAAAGAnpoE3/2rhE59JBgAAgG2zAy/VXQAAAOzANPACAAAAO0PgBQAAwK4ReAEAALBjl8v/AzE7zykvAtvzAAAAAElFTkSuQmCC)

### 对进程抽象，event函数，基于状态机

在每一个时间片里，各个基本事件只执行一次，并且指定了其下一个状态，并将在下一轮时间片内进入被指定状态。这些事件统一为相应的event函数，event函数位于对应的模块的.c和.h文件中，命名规则为"void 事件名的小写标识符_event(local_state_space *事件名的大写标识符_state)"。

### 状态的设计

其状态的可能取值有很多种，我用一个枚举类型将之组织了起来。如图

![avatar](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkIAAAC6CAYAAABC+SJdAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAB4cSURBVHhe7Z3bdbM6EEZdFwW5jlMCb6kiry4gRfwvLiFFcEYXQEgjITB2sLX3WloJIHSb0fAhsH0ZWuB2HS6X63Dzm7s5qhyDlCWF+dQNw93vBwAAgJeBENrCkUKoF/FjRFCPAgIAAPgrEEJbOFIIXVkJAgAA+GsWQujeX4fucpGLvUvdtQ+u0/eh78z+69CLIJjydbI9ZRrzdMG+m1zz3XlGQNz7zpVh//rzp3rD8+pw5ZlzxzQLlfTYnLq4Iitygjzd3PeHyrlmZBNCCAAA4M+ZhFD2Yj8JglHkKCnJsyaEgnOjlAiLErUrNGv57r2IvvCob3MsYlbKcX0Lj/vxSMSQ9FH2ywG/DQAAAH+BF0KjWAkEzD3eFwghET43s08ERChy5jzrQsgKnnH1RITC3YgR/381/vzVU2oFU8DtqrSlWI7ru75CFAgeuxLkU7+lRQAAAHA0TgiNIkRNsRDKi5x6IeSPL4SMz7dFCBmitqsrSqtCKBB5YdokhMZ+aikjhLb2FQAAAA7FCaHpIh4KmJg9Qugu2sFsz3kOF0IhXhTlVmX0kn2bg3eCDNtXhFz765ovNUmdUoHfBgAAgL/ACyF/4beCJUob3v+Z82jpBULI158IIS+Q9KJ9m8ODvl1JW4rljH3LCaUIuzLEy9IAAAB/ySSEzBX5Fn1qzKZNQkgw7xZNYqgbrv3Nn3e8EHJljXW5pD4aE+K8i3zxo0HzDpTJr7SlWI6gtUntE0IIAADgzwmEELwUEUyikkT/oYQAAAD+CoTQX3HjJzYAAAD+GoTQX9KPYgghBAAA8BcghAAAAKBZEEIAAADQLAghAAAAaBaEEAAAADQLQggAAACa5b2F0PgN0D5t+C5G+HTwDciBb0AOfKNJPmRFyH0r9Uc5rZ2QlT/XUeLQcuYAkfsG7xp++6/hv8t/w3/Xf37PM8E3shxVjjB9o/oDA/3vKj5h/MKmr+Hn6V8pgW9kOaic5U83hb9KUM8UL4L0/XSb4RtZDihH+wWGR8f6kesKQuisnCmg2TKCIJb7cdtV/g3f4qhf/Y/9ixDayZl8w49v1/f2714hZINY4A8uqD1bDOEbWQ4ox17sgsF1F799YmjB7Rvf2MOp4kaELfMB37j/DF/iE18dQgin1Xi4HP2HbF1Q2/br+eaO393JOUGEENrJiQKaueN3Y+vG+ZEVoQU2sD37zh/fyHJUOSErP1pdj4sf+MZGzuwbD4337/AjAuir/3Wryp8mhNLls9zgrwyiNVxQjpZxJY8J+EYMLJd69zlDqV/psTklKzBxm6cfyH2wnLDvNnhFSn36kdrO75D8sq0maVPK40II31imP/GNBW6c0+OyLfvVpPqG5wEhhG8s09/7hicRQvKPbKup4Bt2tbD7kcvfdvCNZTqLb9iyg7qkAN0vTIp8w60ef8tVxd1sf5YQsgNZ6xR5p3XGC8vxv6IfZK7JMznrtC/NU0Vtv9bymaCyqDtzIVopZ7Xv9vxZCLlxkO2bC2p+b+qsY1ID2oNCCN8o53uVbyzI1GHONn6gpbWL3Z7HH/hGOd+f+IbDnRPeVEne0RfipF7sJGbYtPOxGL5Rzvdi33D5/BjEN9vmbNmvpoVvLFcHP1QIFRT5gpzTOgPoanU0VE0es7ndIVRq+7Wj7O1trOi7/X8WPlP5/u5uH0cIIXxjS9lP8Y0FmaC5B/sOiFvq3kztGFrwDcPzfUPw7U/O2YNfLdzsH7VjaME3DC/xDYO/nmz1j1j4fOSjsXFwjJHLkyjntD44q2k0Sk0eY0fZVh0iVrIV1PRr1Wmdwy3bK2mT01b0fWpr1E+7f3w0tpXHH43hGyfwjQU+fzrQ2/AiCN9QeFffsGXJsUd9I2B8PLYZfGOqP+Uv4saMXSEqrBIn2FjhHomNfKYQCvGG1h237LTl+VeTR3JtVsaV5PpVLNs7rDhNeNb2NtaPT9y+pdNKAZJHTapjVwghKd+eXxMR8I2AV/pGiMuf1GFKl/1qin3D3+mvBjJ84318w7cz9QuD7JNjalLjxkz2godvvI9vRCzrkr9Sjpq8b1gfMPEikxIKviF73wVnqG1Oa3wifl6ZUpMndQhXp96eLWT65Z1ZdyjvtOFB65yK0xbLqeu7yxPcpSRlyj+yrSY1oK0JIalI+ufKqPlkGr4x81rfmHF9TuowZ8t+NYW+USuC8A3PG/iGLyP1iRHZL8fVVBJC2Y/P4xuON/CNGFtXuBImZ0sdair4Rn5FqOwbsvecuMEUIwQpNqx1pCiPTZGFtLK25tHqyjlCiZp+jcR5F/nGIDMmcY6bya80qliOsGd89vR9+cJjkLQlbqlPKpIkf6PhqRlDfCMo54m+oR43qXQhS3Aff1V94/Lt8wRInVIJvnFq3/AX1vi4Tdu/diP2iaxcljZJBfjGqX1D6/tG4ZSh+GhM2iQVqb5xWiF0Nqzh9ngp7ETG2jrttqD5F+AbrwbfgBz4BuTI+wZCqBKc9sX04qzGaTN3NmcC33gx+AbkwDcgR8E3EEKVlJ3Wvx9RSt3yJTTIcO+ds3bitLf3GDF840XgG5AD34AcFb6BEAIAAIBmQQgBAABAsyCEAAAAoFkQQgAAANAsCCEAAABoFoQQAAAANAtCCAAAAJoFIQQAAADNghACAACAZkEIAQAAQLMghAAAAKBZEEIAAADQLAghAAAAaBaEEAAAADQLQggAAACaBSEEAAAAzYIQAgAAgGZBCAEAAECzIIQAAACgWRBCAAAA0CwIIQAAAGgWhBAAAAA0C0IIAAAAmgUhBAAAAM2CEIJmuF0vw+V681vP5ZV1AQDAfhBCn87tOlwu1+HhS/JR5azw238N/13+i9LX8HP3GR7gY4TQm9l04va9sOv3yyr+EN7U7tOcvv7ze0b+Dd+BPyxS9+PzQBUf5xuOf9fUL379sSNBCH06bzZB7MR4krMjhCJeFvR+h5/OBLJvufTBbt7O7k7ofPU/TvBkLnZLvK9U5YWJD/QNK4IW14Ln+QZC6NN5swmCEKrg3YKeWQl6kk2b4s3sbi5kbtXPr/zUXMDsquExK8BN8XG+oYue8fpwNKcVQuZC0vV3+/dyGVNkIGO0rh8k13Cd8lyG5PpjjRuUE2WoqssQl2PrDjioPbXc+25ZTtDm9NicTF8XFPr1UDmLfsn/sk9NUt/IoUIobo9J8VjX2KIwPhM1dVXwiTY1Qe+rP0gGrdnLHLd9LczBmjxCMk6x3SvLqeET7T5TK4T23fHbfsW28SxuSA6ye+31IjfeW/0jLacR3xgfpY/H/PYzHqlL687J5GTTIN+HvosGfTJIN4y2cgaNHSV00rScqrru/dCF21KinUxPaE8Vtq6wnAxr+Wr6ZVgpZ71f8lfKVVMwQaZnxkHa4/hpe0wXlv2qskXF+NTUVcVH2tRd3L5vPuBNaftjsip72T7JvsIcrMnjYoJSV3hRrKmrhjV7jqzlO9lcnqkUQntXg7L9ce2eLuQV9qqxe3q9cOMcCoacz8WmWGXN5iNr+d7WN8K48bxH69K6c6JeSGIj2e3ZqS3G4NO+aCKMROVU1aWQnHdQe6qw51RMrB1lbx+Pcr8ewt8FbFtRcJM87ULYr/22WJZTU1clH2nTMZAtg9j4/L+eSnvZ7dIcFNby2P8VO2wtpxZbzifP5Roh9MD7H3bMfX8W4x/NzTV72f/X7a6NabwvzZMZ1zVa9o37z/AVxH4bM2S7vRUh1UiBI68a36teNc3nVdXlnSApJzzvoPZU4yfuWIY6yVbbVNEvQ7Gccr8exU6ALQEyE9CWdq61xcr4VNW1gY+zqQt0SfCyQe7Lb9RQaa/VsRHW8kQXvhnXhtmFKuqq5aPncoUQ8v6w790g02ZnL7Nicb1e/fjN+y0H2V2b2/G+w1aEDE36hi6MnRj69lvH8QErQiXjLx04x3pd3onCZXEhOe+g9uzCT5ZkkhTbVNkvQ7Gcmn7JQcmjJnXJdKRwpyjBxp6fBAa9Pct+1bS5Znxq6trJR9jU2S9Z0fOPQRI22jRhdQ4Ka3n8uCd1xRfKmrr28HFzeV0IjSuExXXfrG+4vl9v5q/pl/TBjIMdx6CfB9ldG9N4nxNCsi9I5TGtpBnfcPv1uKEIoaxv1CFnnpPUSM4ICwdYc2whfaaZsl6Xd6Qwj61b2/d4e/bh2phMkNzktlT2y1Asp6ZfckTOV5M6QRzunSHtTlF2SNtdGendiLXpNPF9PyVv2K/1NteNT01d+/gQmybvfuTEbdmmVXOnYg7W5LE2XeTJjetKXbv4ELtPrAgh/wik/Mij7BvGXp1ZCfKdMttmZWhx8T/I7jZPNHjLfe6c3Pg+Riu+4WPE4pG635c8Ui/7Rg1y5jlxDrlMiXEqA5EzXlReUFhVXd5Bpjxi1JspN8x4UHtq0MpIJocnzrvIV9MvT7Ec4Yh+jc+Bp1S6S5T6pBJJ8jfpuhOzYztMW237ovastrlqfOrqWkNryyfY1BC/BJ9950vqk0oyNq1oT80crJynSVyI+11Zzhqfanftgw82Leb0fHErrgYZpE3SENU3xvZOTbS2idp8kN2XoseR7Bvrj1N03hr4RnQ8J6alTdKQbNxY49xCaOPg7uWVdcGRiM2s8+99Pg3nA5tCjnfxjcwjJC9GuNQ8g8d8AyEkIITelF6c3jh/5g4J3hBsCjnexTcygsetpGgvY8PDPOgbCCHhPEJo+YhFTd3yhbcmkUAjgzEMnTj/7eyjgU2reCub1oDdD+MdfUN9NDY+lsM3DuMg3zitEAIAAAB4NgghAAAAaBaEEAAAADQLQggAAACaBSEEAAAAzYIQAgAAgGZBCAEAAECzIIQAAACgWRBCAAAA0CwIIQAAAGgWhBAAAAA0C0IIAAAAmgUhBAAAAM2CEAIAAIBmQQgBAABAsyCEAAAAoFkQQgAAANAsCCEAAABoFoQQAAAANAtCCAAAAJoFIQQAAADNghACAACAZkEIAQAAQLMghAAAAKBZEEIAAADQLAiho7ldh8vlOtz85m4OLecypa6/+wO1/Bu+L/8N/2mp+/F5Ppyz2VS4952z6XV/af+uqT1//bGP52Q2vV3nOXq5dMPmaer57b8WNv0+wtnehRPZdJqfQXpgqs52vf7zeyJu3wu7f/XNzORDQAgdzZkCrC0jCKr3fuhkQm4XQzG/w09XmJSfxplsKmdfrQ17+3evELIiaCF8sOkuDijHXjQDO7qL6HYxlNj0/jN8tSSGTjVPI2yZewSuuxH96n/cDak2P60I+hp+pjjv7I4YqgchdDSnmYz3oe9S0eOC7NVv7SSeeJ/OiQKsWTlw10wniPYJIV302LtOVvm2cVQ5If6GZZNpM6LH2hRxu41n2NTP163T1YhbZ1O/Mp/Y0s3lWPS4FaRvvwVrnFcIGWfsermc+4DvU+hIdjk58qx4n9k2YmC59LzPydPlzrkcbSl0TMkKjJ1oQR7bT8dD5YRjYYNpdAfiA6y5M3FIftlWk7RJ54GVA2yapE02XZATQrIt+9UU2nRcSh/t6Lc3rx5g0yTtt6knEULyj2yrabSpFULKzYm168YLIjZN0qM2tWUHdUkBuj1NGm26ICOENLt7UWxuVqEOGfWTMjnafDF3jjpPgNrJuHRUN7kTx17DtqdiEq/lM0Fu0ebMBW2lnHgsZI9dAZrKsefPY+fGQbZvLsj6vekkHJM6GYVHVoOwabGcVZsuyNRhzpb9akpsGr7/9S1bO8CmxXK22dThzpnH09QtO/Q02VS5QZkuiDuEkJSNTXVqbery+TFY2NMgeWW/mrYIoSgeu/f+ZPvmbA91yKifFOuMkfPYO6V5X/VkXMlThQ8Oq6fVTtoAtT3FcvTHXotzxvHzwmcq347hXrM/+B7J2CZsqlBh0wU5IVSJv0iOS+rji9O7VoSw6UE2FXz7N4sFSyhsJXU/w789j0hsG7CpXs4Omxp83N1nV8OKEPLCZzru5zfUcXIhVHbql05Gg3dmMymzwWq13f7uISjHpk2T0V8E1eTPmdqqB7RdaMuwW8CmhXIqbLrgESGkC1onhvZcNLGpXs5Gm9qy5NiePmfY9Y4QNi2Us3WeztgVotxK+yqlR2Nm3kZx2cdqqAMhtBc/MZMJWWy3n4gyGcKz1PZUTMZyF1yeuH3LySgFSB41KRM2+VSKhpRvz98VqEyWdXu1a9MQH5CTE2TbjL+WJpu6oJp8qiT3Pgk2tTzVpuOFXs0s+8z4a0mZpzPOzuoqHza1PNWmEcu65O9owzipNs0Iocxczn7woWT3hpEROSkVk1F9bi1Gfslk9BMrmYx+kurF+8kYHrT9VNpTLCftu4bLE6wIJWXKP7Ktpngy+juP8qMTqUj658pQPpmGTR+26cwjQsivCC3eC/L7kuCJTS3PtKkvI99X2S/H1ZQTQuNKgboahE0tL5mnHltXuDovZ9vxV9ImIeRFT7gilI3VK3ZvGBmRk1IxGY0z2YvBmMRzrZMGHnzUZHTOH9QlKZmInjjvIt8Y9MYkTn+L2jxSLEfQ2hSXE+fZ2G3PfJEsrgYZpD6pSJL8jYcHm5bLEbQ2heWox03KXRCzjGIoSLlHKFKnVIJNozaPFMsRVJtN5fgLdHzcpm0XK3dBHO258ghb2iQVYNOozSOP2dT3c3F8o3DyLG0apCgWx/myN6zSbmmMbveGOa8QgjdFZqCdaNxxfA7Y9PPApm2C3TUQQnAsvUwwM9Eyd2zwhmDTzwObtgl2V2lcCEXLu1rqli/XQYZ77yZYJxPt9pcjhk0PA5t+Hti0TU5j93PSuBACAACAlkEIAQAAQLMghAAAAKBZEEIAAADQLAghAAAAaBaEEAAAADQLQuhoqr6VtYKjyvFM34S68VtdQ6ZvL819A7FQk+cjOZHd1W+9XXy9/zbWbDr+cr1LD/wo7ztyxvluy5ptv3fKl+wef5OxSeWf3wE4LwihozljYLRfLd8NXfxbO9WMP+z3k/29m7o8H8yJ7G6F0CHfwbJuU3tBDPa7C2RDYuhU8338uY5Hy9kxl+0P9jYmguFjQAgdzakCo2H+gcI9v/NjMHf87m4v/8N/NXk+mhPZ/SghtMumVT/O+0Gcab6bMv7K7j5vM3aHj+K8Qmia1MtvIA2v4zU/6me2JxEwlbMv4KSPHOZy9McRLiU/EGiDXpAnCF4PlaOIHFeea2c6XvK/nKcmaVNKTWB8UAhh9yRttbstKyg7RfLLeWrabXfPXiGE3ZO01e5j3/NIfjlPTQ/a3a4E1vwoM8AJkRlwUqZJP7/b4ILGHIxqA+MyaLhAWw4YCrY9FQF1LZ95TLVosw/8UT/WyonHQva4ZXGl7HFXOl7yvxxX0+7AeIAQkvqxu06N3bWL67Ia2ZB9ajrigrjnEQl2L5azbne3fb358qcUniP/yT417bD78j0hHovB+yIz4KTYwBC94OnfdRn3VQfGlTxV+EC9elptAA1Q21MsZ37ctSA6p2YstvEqIYTd9XLq7J7g+7BZDExU2tS+J2LeLdmxLmDbiN31cmrsPgqgZRm2LlXk1LBhLvuVwF22B/hjTi6EygGmJujV5KnGBmY51yf1wrLabn8nF5Rj06bAGN/1hcmfo5y/u98TrxJC2F0vp8LuGR6zfYVNvQjC7jGvsrvLk3TTi8l9bJvL4+MxgHcDIbQXHyTLd2kxPijKHVp4ltqeisBY6oItcwqWafK55qXxOD3z0VgvgdnUsevC4vu2YtOaPLs4ud11fP3TifJ3tHOc9tjdrwasXjCxu+U5dnd16e0bhZAUMNo5Trvn+4z9GgUtb8nuACdAvPOkVARG9R0CmXAvCYy5wOMDpl58fEESbD+V9hTLSfteQ9pv+d8EKC09TQjJeMkYuHqufl8Adj/c7u6c8LGTnG3HX0lb7V4rgrC745l2t2WHdo7rl792/JX0qBDKfnx+xe4AJ0C886RUBEYzsRdLxjLhbcAIoslRgdEFoqAuSUlQ9MR5F/l8wJuOSwC6RW0eKZYjaG0q9WvvBWH5UmSQgk+JlPIkSLulsZLkbzyE2L1cjrBmd9vP8JjUpbe4zLrdf4efTjlu07fNsUDaLQ3C7lGbRx61u2GtjBpq5rtd/Vkc/xbZlEHaJI3R7Q5wAs4rhOCDkeBtAyN3iG2B3dsEu8O5QQjB6+klIJrAuONuFd4Y7N4m2B1OTuNCKFpq19LOxwqgcO9dQOwkMN7+clSx+0vB7m1yGrsDlGlcCAEAAEDLIIQAAACgWRBCAAAA0CwIIQAAAGgWhBAAAAA0C0IIAAAAmgUhBAAAAM2CEAIAAIBmQQgBAABAsyCEAAAAoFkQQgAAANAsCCEAAABoFoQQAAAANAtCCAAAAJoFIQQAAADNghACAACAZkEIAQAAQLMghAAAAKBZEEIAAADQLAghAAAAaBaEEAAAADQLQggAAACaBSEEAAAAzYIQAgAAgGZBCAEAAECznFsI3a7D5XIdbn7zqbxjXYeWc5lS19/9ge389l/Df5f/hv+u//wendp8WfCNMge2+d531i8u18dKK9l8OrZIX8PPHlfEN8ocVM7tOseMy6UbHggbdfHg9r3wj++XDDq0AEJopNWAZssIgti9H7pdYujf8C3B6av/sX+LAe3+M3zJRe6rW8lXAt8oc0g5t+FqfaG3f/cLoXXfsBfC7mf49dsPgW+UOaAcK44Df3BieY8Yqokbv8OPiRWXb8kNcDwIoZEmA9p96LtU9LigdvVbdfy7jndoLrDlBY4Lal/9rz0HIRRxGt8wRVwGd61zgmivEKrxDYRQBSfyjQR/A7XVRarihlkJOso3ABROKYSmpXglJSsVdlIHeZSZmJY3B4FNdVVwWF1xv7peZIvjsPGxwSu6i/MBzdzdOSS/bKtJ2pRSFkJuCdzd2e0RQof13XOYvSo4rK5X+MaCnBCSbdmvpo2+cYQQOrrvh9mrgsPqerlveBIhJP/Itpo2+oaJE+bGCeBZiFeeGDsZ54AQ4yZ2eNytcCwm7UoZE7X5ShxVlwkqi8CTuRA9Oj72/FkIuWf+sn1zQc3vTQPZmDYLIXdsfLb/zBUhfOOA8Zl4kRAyx4K0+x2QI/p+lL1qOKquP/ENhzsnvKmSvLFPjGmTb7gV5O+bPz4lHpPBcYhXnpjihHWTU7+TCc6x2xVLtmtBpoYn1mVFyqaAVjE+9v9Z+Ezl+7u7feQvdrHweZ4QwjfK5VSOz0ROCG0l7xsJ/sXYXSsBR/TdbuMbE6VzfPuTczaR841RAC2Fj40d3Y/fAniMNxZCPjirKTrHX9jH4+qE3RFkVA6pywWjsYwpbQpoFeMztVV7PDY+GttKJqDZC5sSzJ4ihPCNw8bH8gdCSNjtH/jGMj3TN2xZcuxpvuH2J6uD/gMXAEfw9kJo8/zzAScJNEcFtJBddflgFjzbN2y/s6sZH5cnbp9d5p6Wr6UAyaOmDUvc9qJm9mdSgrTB1qFdEAz4xsRzfCPE5U8vdrIt+9W06fGHhv+kkJYX31D4A9/w7dRFkOyTY2ra5BvzhysW2BsrRQit+QaAgnjMifETLTcp02fZNbiAkQSZlbr2sacuH9DCgzZwKQHngPFJnu0nZco/sq2mBy92+Tt+aYyMgasn8+k1fMPxRN+Yeb0Qcu8Mad8jhG/odb3YN3wZqU+MyH45rqatvuFFz+wLOZFc4RsACuIx58ZNSplwPsXBIT5uUzA5teNJgPGs1bXGYXWNQWZMEjhuJr8SdNbarLUpLifOk41tBbSXXW0qfBKo+OhD2iSNkSR/M2Z4tO/a8V32quCwul7oG+pxk9QLWZ4a30hWDEufIJN2SUPwjTjfy3zDi674uE3bBEht3IjzZd8dk3ZLI4q+ARBzeiEErSJB1wY07uwgBt+AHPgGbAchBOekl0BmAtrGu2toAHwDcuAbsAOE0Cr+/YhS6pYvKMID3HsXyDoJaLezjyq+8VLwDcjxVr4BZwMhBAAAAM2CEAIAAIBmQQgBAABAsyCEAAAAoFkQQgAAANAssxAa37o3X0TFRw8BAACgARQh5FP6ZaQAAAAAH8UshEZu/guplK9lBwAAAPgkUiE0fkU5QggAAAA+nH1CaPxhO94lAgAAgDcmL4TMj9apOkd2dua4pI2/Qg0AAABwJhQhJIwrPrmVIVaEAAAA4APYJ4QAAAAAPgBFCPlHY6XHXtOKECIJAAAA3pe8EMquBAXvCJkvX+TpGAAAALwpO4SQMD06QwgBAADA+5IKoaovVPRiyXyyDAAAAOBNmYVQ/BMbpU+EjWKJT40BAADAG6MLodxq0Jin60QMIYIAAADgvZmFEAAAAEBjIIQAAACgUYbhf8cvmyv4iYMkAAAAAElFTkSuQmCC)sleep_state,开启读数，休眠多少个时间片后苏醒，或者等待外部信号唤醒，即休眠状态下只能由外部将状态修改为准备状态，或者读数读够之后自动将状态替换为其他状态。
prepare_state,准备状态，此状态下检测外部信号判断是否进入运行状态，是则去运行不是则直接返回，若是则需要进行运行所需相关资源的初始化配置，该状态按照约定应当是所以事件第一个进入的状态。
run_state,运行状态，要注意的是，需指定时间或永久休眠。
dead_state,进入该模式后该线程被死锁，并且在死锁状态里应发出错误信号。
每一个状态在结束时应当配置好其下一个状态运行所需环境。
该枚举类型被定义在systimer.h文件中

### 状态机的局部数据空间的设计

参照python的类的设计，为了将数据和操作聚合在一起，每一个事件都有一个自己的专属结构体，这个结构体里存放着该事件所需要的状态数据（枚举类型state）以及一些会用到的操作数据，该结构体应当被定义在main函数while循环上方。并且初始化结构体内状态变量为prepare_state。并且其指针应当在循环中被传入事件函数。该结构体类型被定义在systimer.h文件中。该结构体包含了：1.该状态的下一个状态的指示。2.该状态若进入睡眠状态的睡眠时间变量，睡眠结束后的下一个状态的指示。3.一个指针数组用来指向所需数据的首地址。4.一个整数数组来存放一些小型的零散的数据。（注意：不可把事件函数内的局部变量的地址存放在指针数组内，存放前必须声明为static型变量）

### 全局数据空间设计

进程之间往往需要通信，交换数据，例如按键按下，按键事件发出一个信号，另一个事件则检测这个信号，检测到了再做出相关反应，所以为此而设计了全局变量空间结构体，该结构体被声明在systimer.h文件中，并在main.c文件中被定义并初始化，并在systimer.h中被extern关键字标记。这样可以保证所有包含了systimer.h的文件都可以调用该结构体变量（被声明在main.c文件中的）。（事实上systimer.h应当被包含于每一个基本模块中，并且应当被包含在main.c中）该结构体内部包含有：1.global_interpreter_flag变量。2.两个等级的交互标志位。3.四个不同长度的小数据存放数组，即缓存。4.一个很长的的指针数组global_data_address，用来指向相关数据。

## 二次开发原则

### 接口严谨性

所有的函数名变量名的大小和组成写都应当和例程中的完全同步。
标志位最大的意义就是发送者在准备好待处理数据后，告知接收者让其进行某种状态来处理数据，约定发生标志位者不显式地清除标志位，只有接收方接收后才可 清除标志位，清除统一定为置0，这样可以明显减少丢包率。

### 性能分析

能够适应大多时间在ms级别的任务，对于一些时间在us基本的任务，有两个处理原则：1.将之集成在一起打包塞入一个状态中，该情景适应于此情况：事件会有个别时段以非常频繁的次数进行访问。2.加入紧急中断处理机制，即包装成游离于时间片外的中断事件。对于一些过长的任务，采取切分的策略将之切为多个ms级别的时间段，借助于状态流转逐步完成所有任务。并且应当全面舍弃大于时间片的ms级别软件延迟即循环延迟，借助于sleep_state状态来实现。误差在时间片长度/2以内，若要短时间延迟则直接软件延迟即可，若要长时间延迟，则一般ms级别的误差都不是什么太大的问题，可以加一个修正状态来抹除影响。每一个事件函数都应当在合适的时候释放对cpu资源的占用，并部署好下一个状态的运行环境。这样可以大大加大运行效率，提高cpu的利用率。

### 最大传输效率分析

基于时间片流转，在保证数据接收方响应速度应大于发送方时，即时间片轮转频率大于发生方时。最慢传输延迟约为一个时间片的长度，最快传输时间小于一个时间片的长度，平均时间为1/4个时间片，这个取决于事件存放的先后顺序。（有一些严谨的数学推导还未录入）

## 具体的移植步骤和相关约定[¶](#具体的移植步骤和相关约定)